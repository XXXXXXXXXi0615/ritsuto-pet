<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>å®åŸå¾‹æ–—</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text",
      "Microsoft JhengHei", system-ui, sans-serif;
    }

    /* Hero Section */
    .hero {
      text-align: center;
      padding: 60px 20px 40px;
      background: linear-gradient(135deg, rgba(166,131,255,0.35), rgba(99,102,241,0.35));
      backdrop-filter: blur(8px);
      border-bottom: 1px solid rgba(255,255,255,0.5);
      animation: fadeDown 1s ease forwards;
    }

    .hero h1 {
      font-size: 2rem;
      letter-spacing: 0.08em;
      margin-bottom: 10px;
      color: #4b0082;
    }

    .hero p {
      font-size: 0.9rem;
      color: #555;
    }

    @keyframes fadeDown {
      from { opacity: 0; transform: translateY(-15px); }
      to { opacity: 1; transform: translateY(0); }
    }

    body {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at top, #f6ebff 0, #e5d8ff 40%, #d9e2ff 100%);
      color: #333;
    }

    .app {
      width: 100%;
      max-width: 960px;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 24px;
      box-shadow: 0 20px 45px rgba(70, 50, 120, 0.18);
      padding: 20px 22px 18px;
      backdrop-filter: blur(12px);
    }

    @media (min-width: 768px) {
      .app {
        padding: 24px 28px 20px;
      }
    }
    // ====== å­˜æª”æ§½åˆ‡æ› ======
    const petTabButtons = document.querySelectorAll(".pet-tab");

    function updateSlotTabLabels() {
      petTabButtons.forEach((btn) => {
        const index = Number(btn.getAttribute("data-slot"));
        const slot = petSlots[index];
        const baseName = slot.name || "å­˜æª” " + (index + 1);
        btn.childNodes[0].nodeValue = baseName + " ";
      });
    }

    function switchSlot(index) {
      if (index === currentSlotIndex) return;
      // æŠŠç•¶å‰ç‹€æ…‹å­˜èµ·ä¾†
      copyState(petState, petSlots[currentSlotIndex].state);

      currentSlotIndex = index;
      const slot = petSlots[currentSlotIndex];

      // è¼‰å…¥æ–°ä¿å­˜çš„ç‹€æ…‹
      copyState(slot.state, petState);

      refreshNameDisplay();

      // æ›´æ–° tab æ¨£å¼
      petTabButtons.forEach((btn) => {
        if (Number(btn.getAttribute("data-slot")) === currentSlotIndex) {
          btn.classList.add("active");
        } else {
          btn.classList.remove("active");
        }
      });

      updateUI();
      addLog("å·²åˆ‡æ›åˆ°ã€Œ" + (slot.name || "å­˜æª” " + (currentSlotIndex + 1)) + "ã€ã€‚", true);
    }

    petTabButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        const index = Number(btn.getAttribute("data-slot"));
        switchSlot(index);
      });
    });

    // ====== ç¶å®šæŒ‰éˆ•äº‹ä»¶ ======
    const actionButtons = document.querySelectorAll(".action-btn[data-action]");
    actionButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        const actionKey = btn.getAttribute("data-action");
        applyAction(actionKey);
      });
    });

    // ====== åˆå§‹åŒ– ======
    function init() {
      copyState(petSlots[0].state, petState);
      petSlots[0].name = "å¾‹æ–—-1";
      refreshNameDisplay();
      updateUI();
      updateFocusDisplay();
      updateStudyDisplay();
      updateSlotTabLabels();
      addLog("ç³»çµ±å•Ÿå‹•ï¼šé›»å­å¯µç‰©å¾‹æ–—å·²ä¸Šç·šï¼Œç­‰å¾…ä½ çš„æ“ä½œã€‚", true);
      addLog("æç¤ºï¼šå³å´æœ‰æ‹–å»¶å°éŠæˆ²ï¼Œä¸‹é¢é‚„æœ‰ç•ªèŒ„é˜ï¼Œå¯ä»¥ä¸€èµ·æŠ˜ç£¨è‡ªå·±ã€‚");
    }

    init();
  </script>

  <audio id="bgm" src="èƒŒæ™¯éŸ³ä¹.mp3" autoplay loop muted></audio>

  <script>
    // ğŸ”Š é˜²æ­¢ç€è¦½å™¨é˜»æ“‹éŸ³æ¨‚ï¼Œç¬¬ä¸€æ¬¡é»æ“Šæ‰å•Ÿå‹•
    document.addEventListener(
      "click",
      () => {
        const audio = document.getElementById("bgm");
        audio.muted = false;
        audio.play().catch((e) => console.log("æ’­æ”¾è¢«é˜»æ­¢ï¼š", e));
      },
      { once: true }
    );
  </script>

  <!-- å•Ÿå‹•ç•«é¢ -->
  <div
    id="bootScreen"
    style="
      position: fixed;
      inset: 0;
      background: #0c1024;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      color: #e5e5ff;
      font-size: 1rem;
    "
  >
    <div style="margin-bottom: 12px">å¾‹æ–—ç³»çµ±å•Ÿå‹•ä¸­â€¦</div>

    <div
      style="
        width: 220px;
        height: 6px;
        background: rgba(255, 255, 255, 0.15);
        border-radius: 4px;
        overflow: hidden;
      "
    >
      <span
        style="
          display: block;
          height: 100%;
          width: 0%;
          background: linear-gradient(90deg, #6366f1, #a855f7);
          animation: loadingProgress 2.2s linear forwards;
        "
      ></span>
    </div>
  </div>

  <script>
    window.addEventListener("load", () => {
      setTimeout(() => {
        const bs = document.getElementById("bootScreen");
        if (!bs) return;
        bs.style.transition = "opacity 0.6s ease";
        bs.style.opacity = "0";

        setTimeout(() => bs.remove(), 650);
      }, 2200);
    });
  </script>
</body>
</html>
<!-- ===== è‡ªè¨‚èƒŒæ™¯ + è‡ªè¨‚é ­åƒ ===== -->

<script>
// --- è‡ªè¨‚èƒŒæ™¯ ---
const customBgInput = document.getElementById("customBgInput");

customBgInput.addEventListener("change", function () {
  const file = this.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function (e) {
    const imgData = e.target.result;

    // å¥—ç”¨èƒŒæ™¯
    document.body.style.background = `url('${imgData}') center/cover fixed`;

    // å­˜åˆ° localStorageï¼ˆè¨˜æ†¶èƒŒæ™¯ï¼‰
    localStorage.setItem("ritsuto_custom_bg", imgData);

    addLog("å·²å¥—ç”¨è‡ªè¨‚èƒŒæ™¯åœ–ç‰‡ã€‚", true);
  };

  reader.readAsDataURL(file);
});

// --- è¼‰å…¥èƒŒæ™¯ ---
(function loadCustomBgFromStorage() {
  const bg = localStorage.getItem("ritsuto_custom_bg");
  if (bg) {
    document.body.style.background = `url('${bg}') center/cover fixed`;
  }
})();

// --- è‡ªè¨‚é ­åƒ ---
const petFaceEl2 = document.getElementById("petFace");
const customAvatarInput = document.createElement("input");
customAvatarInput.type = "file";
customAvatarInput.accept = "image/*";
customAvatarInput.style.display = "none";
document.body.appendChild(customAvatarInput);

// é»æ“Šé ­åƒå¯æ›´æ›è‡ªè¨‚åœ–ç‰‡
document.getElementById("petAvatar").addEventListener("click", () => {
  customAvatarInput.click();
});

// ä¸Šå‚³æ–°é ­åƒ
customAvatarInput.addEventListener("change", function () {
  const file = this.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function (e) {
    const imgData = e.target.result;

    // æŠŠ Qç‰ˆå¾‹æ–—åœ–ç‰‡å¡é€²é ­åƒ
    petFaceEl2.innerHTML = `<img src="${imgData}" style="width:120px;height:auto;user-select:none;">`;

    // å­˜å…¥ localStorageï¼Œé‡æ•´ä¸æœƒæ¶ˆå¤±
    localStorage.setItem("ritsuto_custom_avatar", imgData);

    addLog("é ­åƒå·²æˆåŠŸæ›¿æ›ç‚ºä½ çš„è‡ªè¨‚å¾‹æ–—å½¢è±¡ã€‚", true);
  };

  reader.readAsDataURL(file);
});

// å•Ÿå‹•æ™‚è‡ªå‹•è¼‰å…¥è‡ªè¨‚é ­åƒ
(function loadCustomAvatar() {
  const avatar = localStorage.getItem("ritsuto_custom_avatar");
  if (avatar) {
    petFaceEl2.innerHTML = `<img src="${avatar}" style="width:120px;height:auto;user-select:none;">`;
  }
})();
</script>
