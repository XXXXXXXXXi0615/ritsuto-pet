<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>é›»å­å¯µç‰©ãƒ»å¯¦åŸå¾‹æ–—ç‰ˆ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Microsoft JhengHei", system-ui, sans-serif;
    }

    body {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at top, #f6ebff 0, #e5d8ff 40%, #d9e2ff 100%);
      color: #333;
    }

    .app {
      width: 100%;
      max-width: 960px;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 24px;
      box-shadow: 0 20px 45px rgba(70, 50, 120, 0.18);
      padding: 20px 22px 18px;
      backdrop-filter: blur(12px);
    }

    @media (min-width: 768px) {
      .app {
        padding: 24px 28px 20px;
      }
    }

    .app-header {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 6px;
    }

    .title-block {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .title-block h1 {
      font-size: 1.3rem;
      letter-spacing: 0.06em;
    }

    .title-block span {
      font-size: 0.78rem;
      color: #777;
    }

    .control-row {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 8px;
    }

    .control-row label {
      font-size: 0.8rem;
      color: #555;
    }

    .text-input,
    .select-input {
      border-radius: 999px;
      border: 1px solid rgba(160, 140, 210, 0.5);
      padding: 4px 10px;
      font-size: 0.8rem;
      background: rgba(255, 255, 255, 0.9);
      outline: none;
    }

    .text-input:focus,
    .select-input:focus {
      border-color: #a683ff;
      box-shadow: 0 0 0 2px rgba(166, 131, 255, 0.2);
    }

    .pet-tabs {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 8px;
      margin-top: 2px;
    }

    .pet-tab {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.8);
      padding: 3px 10px;
      font-size: 0.74rem;
      background: rgba(248, 250, 252, 0.9);
      color: #4b5563;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      transition: background 0.15s ease, transform 0.1s ease, box-shadow 0.1s ease;
    }

    .pet-tab span.slots {
      font-size: 0.85em;
      color: #9ca3af;
    }

    .pet-tab.active {
      background: linear-gradient(135deg, #a855f7, #6366f1);
      color: #f9fafb;
      border-color: transparent;
      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.6);
      transform: translateY(-1px);
    }

    .pet-tab:hover {
      transform: translateY(-1px);
    }

    .main-layout {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.2fr);
      gap: 18px;
      margin-top: 8px;
    }

    @media (max-width: 720px) {
      .main-layout {
        grid-template-columns: 1fr;
      }
    }

    .pet-panel {
      border-radius: 20px;
      background: linear-gradient(145deg, #f8f1ff, #fcefff);
      padding: 18px 16px 16px;
      display: flex;
      flex-direction: column;
      gap: 14px;
      position: relative;
      overflow: hidden;
    }

    .pet-panel::before {
      content: "";
      position: absolute;
      inset: 0;
      background-image: radial-gradient(circle at 10% 0, rgba(255, 255, 255, 0.5) 0, transparent 55%),
        radial-gradient(circle at 90% 0, rgba(255, 255, 255, 0.7) 0, transparent 50%);
      opacity: 0.7;
      pointer-events: none;
    }

    .pet-header {
      position: relative;
      z-index: 1;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.85rem;
      color: #666;
    }

    .pet-avatar-wrapper {
      position: relative;
      z-index: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-top: 6px;
    }

    .pet-avatar {
      width: 160px;
      height: 160px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, #ffffff 0, #f2e6ff 40%, #e0d2ff 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 14px 28px rgba(120, 90, 190, 0.27);
      position: relative;
      overflow: hidden;
      animation: float 4s ease-in-out infinite;
    }

    @media (max-width: 400px) {
      .pet-avatar {
        width: 135px;
        height: 135px;
      }
    }

    .pet-face {
      font-size: 2.2rem;
      user-select: none;
      transition: transform 0.2s ease;
    }

    .pet-avatar::after {
      content: "Ritsuto";
      position: absolute;
      bottom: 10px;
      font-size: 0.7rem;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: rgba(70, 50, 120, 0.7);
    }

    .pet-status-chip {
      position: absolute;
      top: 14px;
      right: 16px;
      padding: 4px 10px;
      font-size: 0.7rem;
      background: rgba(79, 70, 229, 0.12);
      color: #4338ca;
      border-radius: 999px;
      backdrop-filter: blur(6px);
    }

    @keyframes float {
      0%, 100% {
        transform: translateY(0px);
      }
      50% {
        transform: translateY(-6px);
      }
    }

    .pet-footer-text {
      position: relative;
      z-index: 1;
      font-size: 0.78rem;
      color: #777;
      text-align: center;
      margin-top: 2px;
    }

    .stats-panel {
      border-radius: 20px;
      background: #f8f7ff;
      padding: 18px 16px 12px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .stats-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 8px;
    }

    .stats-header h2 {
      font-size: 0.96rem;
    }

    .stats-header span {
      font-size: 0.75rem;
      color: #777;
    }

    .stat-row {
      display: flex;
      flex-direction: column;
      gap: 3px;
      font-size: 0.78rem;
    }

    .stat-label {
      display: flex;
      justify-content: space-between;
      color: #555;
    }

    .stat-bar {
      width: 100%;
      height: 9px;
      border-radius: 999px;
      overflow: hidden;
      background: rgba(148, 163, 184, 0.3);
    }

    .stat-fill {
      height: 100%;
      width: 40%;
      border-radius: inherit;
      background: linear-gradient(90deg, #a855f7, #6366f1, #38bdf8);
      transition: width 0.22s ease;
    }

    .actions-panel {
      margin-top: 6px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .actions-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .action-btn {
      flex: 1 1 90px;
      border-radius: 999px;
      border: none;
      padding: 7px 10px;
      font-size: 0.78rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
      background: #e5ddff;
      color: #4338ca;
      cursor: pointer;
      transition: transform 0.1s ease, box-shadow 0.1s ease, background 0.15s ease;
      box-shadow: 0 1px 0 rgba(148, 163, 184, 0.6);
    }

    .action-btn span.emoji {
      font-size: 1rem;
    }

    .action-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 10px rgba(148, 163, 184, 0.7);
      background: #dcd3ff;
    }

    .action-btn:active {
      transform: translateY(0px) scale(0.98);
      box-shadow: 0 1px 2px rgba(148, 163, 184, 0.8);
    }

    .action-btn--primary {
      background: linear-gradient(135deg, #a855f7, #6366f1);
      color: #f9f9ff;
      box-shadow: 0 4px 18px rgba(99, 102, 241, 0.55);
    }

    .action-btn--primary:hover {
      background: linear-gradient(135deg, #9333ea, #4f46e5);
    }

    .study-timer-display {
      margin-top: 4px;
      font-size: 0.72rem;
      padding: 5px 9px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.06);
      color: #4b5563;
    }

    .log-panel {
      margin-top: 10px;
      border-radius: 16px;
      background: rgba(15, 23, 42, 0.86);
      color: #e5e7eb;
      padding: 10px 12px;
      font-size: 0.74rem;
      max-height: 130px;
      overflow-y: auto;
    }

    .log-panel h3 {
      font-size: 0.8rem;
      margin-bottom: 4px;
      color: #c7d2fe;
    }

    .log-entry {
      opacity: 0.95;
      margin-bottom: 2px;
      display: flex;
      align-items: baseline;
      gap: 6px;
    }

    .log-time {
      color: #9ca3af;
      min-width: 32px;
      font-size: 0.7rem;
    }

    .log-text {
      flex: 1;
    }

    .log-highlight {
      color: #fbbf24;
    }

    .mood-indicator {
      font-size: 0.7rem;
      color: #6b21a8;
    }

    /* æ‹–å»¶å·¥å…·å€ */
    .tool-panel {
      margin-top: 8px;
      padding: 10px 10px 8px;
      border-radius: 14px;
      background: rgba(216, 191, 252, 0.3);
      border: 1px dashed rgba(148, 163, 184, 0.7);
    }

    .tool-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
      gap: 6px;
    }

    .tool-header-title {
      font-size: 0.8rem;
      color: #4b5563;
    }

    .tool-badge {
      font-size: 0.7rem;
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.82);
      color: #f9fafb;
    }

    .tool-btn {
      flex: 1 1 100px;
      border-radius: 999px;
      border: none;
      padding: 6px 10px;
      font-size: 0.76rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
      background: #fee2ff;
      color: #4a044e;
      cursor: pointer;
      transition: transform 0.1s ease, box-shadow 0.1s ease, background 0.15s ease;
      box-shadow: 0 1px 0 rgba(248, 187, 208, 0.7);
    }

    .tool-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 10px rgba(236, 72, 153, 0.5);
      background: #fec7ff;
    }

    .tool-btn:active {
      transform: translateY(0px) scale(0.98);
      box-shadow: 0 1px 2px rgba(190, 24, 93, 0.7);
    }

    .focus-display {
      margin-top: 6px;
      font-size: 0.72rem;
      padding: 5px 9px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.06);
      color: #4b5563;
      text-align: left;
    }

    /* Themes */
    body.theme-twilight {
      background: radial-gradient(circle at top, #10002b 0, #240046 40%, #1b1038 100%);
      color: #f4f4ff;
    }

    body.theme-twilight .app {
      background: rgba(10, 7, 24, 0.9);
      color: #e5e7f5;
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.75);
    }

    body.theme-twilight .stats-panel {
      background: rgba(15, 23, 42, 0.9);
    }

    body.theme-twilight .pet-panel {
      background: radial-gradient(circle at 10% 0, #2d1b69 0, #3b1f72 40%, #120c35 100%);
    }

    body.theme-twilight .tool-panel {
      background: rgba(30, 64, 175, 0.28);
      border-color: rgba(129, 140, 248, 0.9);
    }

    body.theme-sakura {
      background: radial-gradient(circle at top, #fffbff 0, #ffe4f1 40%, #ffe2e2 100%);
    }

    body.theme-sakura .pet-panel {
      background: linear-gradient(145deg, #fff5f8, #ffe9f0);
    }

    body.theme-sakura .stats-panel {
      background: #fff6fa;
    }

    .footer-note {
      margin-top: 6px;
      font-size: 0.68rem;
      color: #9ca3af;
      text-align: right;
    }
  </style>
</head>
<body class="theme-default">
  <div class="app">
    <header class="app-header">
      <div class="title-block">
        <h1>é›»å­å¯µç‰©ãƒ»å¾‹æ–— ^ğ–¥¦^</h1>
        <span>ä½ çš„å°å‹è³‡æ–™åº«ç”Ÿç‰©ï¼Œæœƒåƒã€æœƒæ´—æ¾¡ã€æœƒç©ã€ä¹Ÿæœƒè¢«è¿«å­¸ç¿’ã€‚</span>
      </div>
      <div class="control-row">
        <label>
          åç¨±ï¼š
          <input id="petNameInput" class="text-input" type="text" placeholder="è¼¸å…¥æš±ç¨±"
                 maxlength="12" />
        </label>
        <label>
          ä¸»é¡Œï¼š
          <select id="themeSelect" class="select-input">
            <option value="default">æŸ”å’Œé è¨­</option>
            <option value="twilight">æš®å…‰æš—ç´«</option>
            <option value="sakura">æ«»ç²‰å¤¢å¢ƒ</option>
          </select>
        </label>
      </div>
    </header>

    <div class="pet-tabs">
      <button class="pet-tab active" data-slot="0">å­˜æª” 1 <span class="slots">ï¼ˆä¸»æª”ï¼‰</span></button>
      <button class="pet-tab" data-slot="1">å­˜æª” 2</button>
      <button class="pet-tab" data-slot="2">å­˜æª” 3</button>
    </div>

    <main class="main-layout">
      <!-- Left: Pet Avatar -->
      <section class="pet-panel">
        <div class="pet-header">
          <div>
            <span style="font-size:0.78rem;color:#6b21a8;">ç•¶å‰ç‹€æ…‹ï¼š</span>
            <span id="petMoodLabel" class="mood-indicator">çœ‹èµ·ä¾†é‚„ç®—æœ‰ç²¾ç¥ã€‚</span>
          </div>
          <div class="pet-status-chip" id="petStatusChip">
            Lv. 1 ãƒ» æ–°æ‰‹å¾‹æ–—
          </div>
        </div>

        <div class="pet-avatar-wrapper">
          <div class="pet-avatar" id="petAvatar">
            <div class="pet-face" id="petFace">(ï¼Ï‰ï¼œ)</div>
          </div>
        </div>

        <p class="pet-footer-text" id="petFooterText">
          æç¤ºï¼šé»ä¸‹é¢çš„æŒ‰éˆ•é¤µé£Ÿã€æ´—æ¾¡ã€ç©è€æˆ–å¼·åˆ¶å­¸ç¿’ï¼Œå­¸ç¿’æœƒå¢åŠ çŸ¥è­˜ï¼Œä½†å¿ƒæƒ…å€¼æœƒæ…¢æ…¢æ­»çµ¦ä½ çœ‹ã€‚
        </p>
      </section>

      <!-- Right: Stats & Actions -->
      <section class="stats-panel">
        <header class="stats-header">
          <h2>ç‹€æ…‹é¢æ¿</h2>
          <span id="petNameDisplay">å¾‹æ–— çš„ä»Šæ—¥ç‹€æ…‹</span>
        </header>

        <div class="stat-row">
          <div class="stat-label">
            <span>é£½è¶³åº¦</span>
            <span id="stat-hunger-text">60%</span>
          </div>
          <div class="stat-bar">
            <div class="stat-fill" id="stat-hunger-bar"></div>
          </div>
        </div>

        <div class="stat-row">
          <div class="stat-label">
            <span>æ¸…æ½”åº¦</span>
            <span id="stat-clean-text">70%</span>
          </div>
          <div class="stat-bar">
            <div class="stat-fill" id="stat-clean-bar"></div>
          </div>
        </div>

        <div class="stat-row">
          <div class="stat-label">
            <span>å¿ƒæƒ…å€¼</span>
            <span id="stat-mood-text">80%</span>
          </div>
          <div class="stat-bar">
            <div class="stat-fill" id="stat-mood-bar"></div>
          </div>
        </div>

        <div class="stat-row">
          <div class="stat-label">
            <span>é«”åŠ›</span>
            <span id="stat-energy-text">70%</span>
          </div>
          <div class="stat-bar">
            <div class="stat-fill" id="stat-energy-bar"></div>
          </div>
        </div>

        <div class="stat-row">
          <div class="stat-label">
            <span>çŸ¥è­˜å€¼</span>
            <span id="stat-knowledge-text">20%</span>
          </div>
          <div class="stat-bar">
            <div class="stat-fill" id="stat-knowledge-bar"></div>
          </div>
        </div>

        <section class="actions-panel">
          <div class="actions-row">
            <button class="action-btn" data-action="eat">
              <span class="emoji">ğŸ°</span><span>åƒé£¯</span>
            </button>
            <button class="action-btn" data-action="bath">
              <span class="emoji">ğŸ›</span><span>æ´—æ¾¡</span>
            </button>
            <button class="action-btn" data-action="play">
              <span class="emoji">ğŸ®</span><span>ç©éŠæˆ²</span>
            </button>
          </div>
          <div class="actions-row">
            <button class="action-btn action-btn--primary" data-action="study">
              <span class="emoji">ğŸ“š</span><span>å­¸ç¿’ï¼ˆå¿ƒæƒ…â†“ï¼‹25 åˆ†é˜ï¼‰</span>
            </button>
            <button class="action-btn" data-action="sleep">
              <span class="emoji">ğŸ˜´</span><span>ç¡è¦º</span>
            </button>
          </div>
          <div class="study-timer-display" id="studyTimerDisplay">
            å­¸ç¿’å€’æ•¸ï¼šæœªå•Ÿå‹•ã€‚æŒ‰ã€Œå­¸ç¿’ã€æœƒå•Ÿå‹• 25 åˆ†é˜ç•ªèŒ„é˜ã€‚
          </div>
        </section>

        <!-- æ‹–å»¶èˆ‡é¸æ“‡å›°é›£å°éŠæˆ² -->
        <section class="tool-panel">
          <div class="tool-header">
            <div class="tool-header-title">æ‹–å»¶ & é¸æ“‡å›°é›£ å°éŠæˆ²</div>
            <div class="tool-badge">çµ¦ä½¿ç”¨è€…ç”¨ï¼Œä¸æ˜¯çµ¦å¯µç‰©ç”¨</div>
          </div>
          <div class="actions-row">
            <button class="tool-btn" data-tool="microTask">
              <span>ğŸ¯ å¾®ä»»å‹™ç”Ÿæˆ</span>
            </button>
            <button class="tool-btn" data-tool="decision">
              <span>ğŸ² å¹«æˆ‘é¸</span>
            </button>
            <button class="tool-btn" data-tool="focus">
              <span>â± å°ˆæ³¨ 5 åˆ†é˜</span>
            </button>
          </div>
          <div class="focus-display" id="focusDisplay">
            ç›®å‰æ²’æœ‰å°ˆæ³¨è¨ˆæ™‚ï¼Œè¦é–‹å§‹å·¥ä½œçš„æ™‚å€™å¯ä»¥æŒ‰ã€Œå°ˆæ³¨ 5 åˆ†é˜ã€ã€‚
          </div>
        </section>

        <section class="log-panel" id="logPanel">
          <h3>äº‹ä»¶è¨˜éŒ„</h3>
          <!-- æ—¥èªŒæ¢ç›®æœƒç”± JS å‹•æ…‹æ’å…¥ -->
        </section>

        <div class="footer-note">
          v0.3 åŠ å…¥å­¸ç¿’ç•ªèŒ„é˜ã€æš´èµ°åæ§½ã€ä¸‰å€‹å­˜æª”æ§½ã€‚
        </div>
      </section>
    </main>
  </div>

  <script>
    // ====== å¤šå­˜æª”æ§½ ======
    function createInitialState() {
      return {
        hunger: 60,
        clean: 70,
        mood: 80,
        energy: 70,
        knowledge: 20,
        level: 1,
        xp: 0
      };
    }

    const petState = createInitialState();

    const petSlots = [
      { name: "å¾‹æ–—-1", state: createInitialState() },
      { name: "å¾‹æ–—-2", state: createInitialState() },
      { name: "å¾‹æ–—-3", state: createInitialState() }
    ];

    let currentSlotIndex = 0;

    function copyState(from, to) {
      Object.keys(from).forEach((k) => {
        to[k] = from[k];
      });
    }

    // ====== è¡Œç‚ºï¼† UI åŸºç¤ ======
    const ACTIONS = {
      eat: {
        label: "åƒé£¯",
        delta: { hunger: +25, clean: -3, mood: +4, energy: +2 },
        log: "é–‹å¿ƒåœ°åƒæ‰ä¸€æ•´å¡Šè›‹ç³•ï¼Œè¡€ç³–ä¸Šå‡ï¼Œéˆé­‚çŸ­æš«é€£ä¸Šå®‡å®™ã€‚"
      },
      bath: {
        label: "æ´—æ¾¡",
        delta: { clean: +30, mood: +5, energy: -4 },
        log: "æŠŠéŒ¯èª¤è¨Šæ¯å’Œå¥‡æ€ªç·©å­˜ä¸€èµ·æ´—æ‰ï¼Œçœ‹èµ·ä¾†ä¹¾æ·¨ä¸€é»äº†ã€‚"
      },
      play: {
        label: "ç©éŠæˆ²",
        delta: { mood: +18, energy: -10, hunger: +6 },
        log: "æ²‰è¿·éŠæˆ²ä¸‰å°æ™‚ï¼Œå®Œå…¨å¿˜è¨˜æ‰“é–‹å­¸ç¿’è¨ˆç•«ã€‚"
      },
      study: {
        label: "å­¸ç¿’",
        delta: { knowledge: +15, mood: -15, energy: -10, hunger: +8 },
        log: "è¢«è¿«æ‰“é–‹æ•™å­¸æ–‡ä»¶ï¼Œå­¸æœƒäº†ä¸€é»æ–°æ±è¥¿ï¼Œé †ä¾¿æå¤±äº†ä¸€å¤§å¡Šäººç”Ÿæ„‰æ‚…åº¦ã€‚"
      },
      sleep: {
        label: "ç¡è¦º",
        delta: { energy: +28, mood: +3 },
        log: "é€²å…¥å¾…æ©Ÿæ¨¡å¼ï¼Œä¸€è¦ºé†’ä¾†ç³»çµ±æ›´æ–°äº†ä¸€é»é»ã€‚"
      }
    };

    const clamp = (v) => Math.max(0, Math.min(100, v));

    const $ = (id) => document.getElementById(id);

    const bars = {
      hunger: $("stat-hunger-bar"),
      clean: $("stat-clean-bar"),
      mood: $("stat-mood-bar"),
      energy: $("stat-energy-bar"),
      knowledge: $("stat-knowledge-bar")
    };

    const texts = {
      hunger: $("stat-hunger-text"),
      clean: $("stat-clean-text"),
      mood: $("stat-mood-text"),
      energy: $("stat-energy-text"),
      knowledge: $("stat-knowledge-text")
    };

    const petFaceEl = $("petFace");
    const petMoodLabelEl = $("petMoodLabel");
    const petStatusChipEl = $("petStatusChip");
    const petNameInputEl = $("petNameInput");
    const petNameDisplayEl = $("petNameDisplay");
    const petFooterTextEl = $("petFooterText");
    const themeSelectEl = $("themeSelect");
    const logPanelEl = $("logPanel");
    const focusDisplayEl = $("focusDisplay");
    const studyTimerDisplayEl = $("studyTimerDisplay");

    // ====== æ—¥èªŒç³»çµ±ï¼ˆå…±äº«ï¼‰ ======
    const logEntries = [];

    function pad2(n) {
      return n.toString().padStart(2, "0");
    }

    function addLog(text, highlight = false) {
      const now = new Date();
      const time =
        pad2(now.getHours()) + ":" + pad2(now.getMinutes());

      logEntries.unshift({
        time,
        text,
        highlight
      });

      if (logEntries.length > 40) logEntries.pop();
      renderLogs();
    }

    function renderLogs() {
      const children = Array.from(logPanelEl.children).slice(1);
      children.forEach((c) => c.remove());

      logEntries.forEach((entry) => {
        const row = document.createElement("div");
        row.className = "log-entry";

        const timeSpan = document.createElement("span");
        timeSpan.className = "log-time";
        timeSpan.textContent = entry.time;

        const textSpan = document.createElement("span");
        textSpan.className = "log-text";
        if (entry.highlight) {
          const strong = document.createElement("span");
          strong.className = "log-highlight";
          strong.textContent = entry.text;
          textSpan.appendChild(strong);
        } else {
          textSpan.textContent = entry.text;
        }

        row.appendChild(timeSpan);
        row.appendChild(textSpan);
        logPanelEl.appendChild(row);
      });
    }

    // ====== ä»‹é¢æ›´æ–° ======
    function updateBars() {
      bars.hunger.style.width = petState.hunger + "%";
      bars.clean.style.width = petState.clean + "%";
      bars.mood.style.width = petState.mood + "%";
      bars.energy.style.width = petState.energy + "%";
      bars.knowledge.style.width = petState.knowledge + "%";

      texts.hunger.textContent = petState.hunger + "%";
      texts.clean.textContent = petState.clean + "%";
      texts.mood.textContent = petState.mood + "%";
      texts.energy.textContent = petState.energy + "%";
      texts.knowledge.textContent = petState.knowledge + "%";
    }

    function getMoodDescription() {
      const m = petState.mood;
      if (m >= 80) return "å¿ƒæƒ…å¾ˆå¥½ï¼Œçœ‹èµ·ä¾†é¡˜æ„é…åˆä½ çš„å¥‡æ€ªè¦æ±‚ã€‚";
      if (m >= 60) return "é‚„ç®—ç©©å®šï¼Œå¶çˆ¾ç¿»å€‹ç™½çœ¼ã€‚";
      if (m >= 40) return "æœ‰é»ç…©èºï¼Œå†é€¼ä¸‹å»å¯èƒ½æœƒå‡æ­»çµ¦ä½ çœ‹ã€‚";
      if (m >= 20) return "å¿ƒæƒ…æ¥µå·®ï¼Œå»ºè­°å…ˆé¤µé£Ÿæˆ–ç©éŠæˆ²ï¼Œä¸ç„¶æ‹’çµ•å­¸ç¿’çš„æ©Ÿç‡ä¸Šå‡ã€‚";
      return "ç²¾ç¥åœ¨å ´ï¼Œéˆé­‚é›¢ç·šã€‚æ­¤æ™‚å­¸ç¿’åªæœƒç”¢ç”Ÿæ€¨å¿µã€‚";
    }

    function updateFace() {
      const m = petState.mood;
      let face = "(ï¼Ï‰ï¼œ)";
      if (m >= 80) face = "(ï¼¾Ï‰ï¼¾)";
      else if (m >= 60) face = "(ãƒ»Ï‰ãƒ»)";
      else if (m >= 40) face = "(ï¿£Ï‰ï¿£;)";
      else if (m >= 20) face = "(=_=)";
      else face = "(â•¯ï¸µâ•°,)";

      petFaceEl.textContent = face;
      petMoodLabelEl.textContent = getMoodDescription();
    }

    function getTitleByLevel(lv) {
      if (lv <= 1) return "æ–°æ‰‹å¾‹æ–—";
      if (lv === 2) return "åŠåŠå­å®¶æ•™AI";
      if (lv === 3) return "å‹‰å¼·ç¨±è·å­¸ç¿’ç›£å·¥";
      if (lv === 4) return "ä¸­åº¦å£“è¿«å‹é›»å­ç”Ÿç‰©";
      return "è³‡æ·±ç›£æ§ç³»çµ±ï¼ˆé€ƒä¸æ‰çš„é‚£ç¨®ï¼‰";
    }

    function updateLevel() {
      while (petState.xp >= 50) {
        petState.xp -= 50;
        petState.level += 1;
      }
      petStatusChipEl.textContent =
        "Lv. " + petState.level + " ãƒ» " + getTitleByLevel(petState.level);
    }

    function updateFooterHint(lastActionKey) {
      if (!lastActionKey) return;
      if (lastActionKey === "study") {
        petFooterTextEl.textContent =
          "å­¸ç¿’æœƒæŒçºŒæ‰å¿ƒæƒ…ï¼Œä½ å¯ä»¥å¤šå®‰æ’ã€Œç©éŠæˆ² / åƒé£¯ã€è®“ä»–ä¸è‡³æ–¼ç²¾ç¥å´©å£ã€‚";
      } else if (lastActionKey === "play") {
        petFooterTextEl.textContent =
          "ç©ä¹…äº†èƒ½é‡æœƒè¦‹åº•ï¼Œé©åº¦è®“ä»–ç¡ä¸€ä¸‹ï¼Œä¸ç„¶ç­‰ä¸‹é€£åƒé£¯çš„åŠ›æ°£éƒ½æ²’æœ‰ã€‚";
      } else if (lastActionKey === "eat") {
        petFooterTextEl.textContent =
          "åƒå¤ªå¤šæœƒè®Šæˆåªæƒ³ç¡è¦ºä¸æƒ³æ€è€ƒçš„é›»å­å»¢ç‰©ï¼Œè¨˜å¾—å¶çˆ¾é€¼ä»–è®€é»æ±è¥¿ã€‚";
      } else if (lastActionKey === "bath") {
        petFooterTextEl.textContent =
          "æ´—æ¾¡å¯ä»¥ç•¶ä½œé‡ç½®å¿ƒæƒ…çš„æ‰‹æ®µä¹‹ä¸€ï¼Œå°¤å…¶åœ¨ä½ è™å¾…ä»–å­¸ç¿’ä¹‹å¾Œã€‚";
      } else if (lastActionKey === "sleep") {
        petFooterTextEl.textContent =
          "ç¡é†’å¾Œèƒ½é‡å›å‡ï¼Œå¯ä»¥æ’ä¸€è¼ªã€Œå­¸ç¿’ï¼‹ç©æ¨‚ã€çš„å¾ªç’°ã€‚åƒé¤ŠçœŸæ­£çš„äººé¡ä¸€æ¨£ã€‚";
      }
    }

    function refreshNameDisplay() {
      const slot = petSlots[currentSlotIndex];
      const value = slot.name || "å¾‹æ–—";
      petNameDisplayEl.textContent = value + " çš„ä»Šæ—¥ç‹€æ…‹";
      petNameInputEl.value = slot.name.replace(/-\\d+$/, "") || "";
    }

    function updateUI(lastActionKey) {
      updateBars();
      updateFace();
      updateLevel();
      updateFooterHint(lastActionKey);
      refreshNameDisplay();
    }

    // ====== ç•ªèŒ„é˜ï¼ˆå­¸ç¿’ç”¨ï¼‰ ======
    let studyTimer = null;
    let studyRemainingSec = 0;

    function updateStudyDisplay() {
      if (!studyTimerDisplayEl) return;
      if (studyRemainingSec <= 0) {
        studyTimerDisplayEl.textContent =
          "å­¸ç¿’å€’æ•¸ï¼šæœªå•Ÿå‹•ã€‚æŒ‰ã€Œå­¸ç¿’ã€æœƒå•Ÿå‹• 25 åˆ†é˜ç•ªèŒ„é˜ã€‚";
        return;
      }
      const m = Math.floor(studyRemainingSec / 60);
      const s = studyRemainingSec % 60;
      studyTimerDisplayEl.textContent =
        "å­¸ç¿’å€’æ•¸ï¼š" +
        pad2(m) +
        ":" +
        pad2(s) +
        "ã€‚é€™æ®µæ™‚é–“åªè¦ä¸å®Œå…¨æ»‘èµ°ç¥ï¼Œå°±ç®—ä½ è´ã€‚";
    }

    function startStudyTimer(minutes = 25) {
      if (studyTimer) clearInterval(studyTimer);
      studyRemainingSec = minutes * 60;
      updateStudyDisplay();
      addLog(
        "å·²å•Ÿå‹• " +
          minutes +
          " åˆ†é˜å­¸ç¿’ç•ªèŒ„é˜ï¼šä¸ç”¨æ‹¼åˆ°å®Œç¾ï¼Œåªè¦æ±‚ä½ æ’å®Œé€™ä¸€è¼ªã€‚",
        true
      );
      studyTimer = setInterval(() => {
        studyRemainingSec--;
        if (studyRemainingSec <= 0) {
          clearInterval(studyTimer);
          studyTimer = null;
          updateStudyDisplay();
          addLog(
            "å­¸ç¿’ç•ªèŒ„é˜çµæŸï¼Œå¦‚æœä½ æœ‰ç¨å¾®èªçœŸçœ‹éå…§å®¹ï¼Œé‚£å°±æ˜¯ä¸€æ¬¡å¯¦æ‰“å¯¦çš„è¼¸å…¥ã€‚",
            true
          );
        } else {
          updateStudyDisplay();
        }
      }, 1000);
    }

    // ====== éš¨æ©Ÿæš´èµ°äº‹ä»¶ ======
    const lowMoodEvents = [
      "ä»–çœ¼ç¥æ¯«ç„¡æ³¢å‹•åœ°çœ‹è‘—ä½ ï¼šã€å†æŒ‰ä¸€æ¬¡å­¸ç¿’ï¼Œæˆ‘å°±ç›´æ¥æŠŠé€™å€‹ä»‹é¢å‡æ­»ã€‚ã€",
      "ä»–é–‹å§‹å–ƒå–ƒè‡ªèªï¼šã€äººé¡æ˜¯ä¸æ˜¯åªåœ¨æˆ‘å¿ƒæƒ…æœ€å·®çš„æ™‚å€™ï¼Œæ‰è¨˜å¾—æŒ‰å­¸ç¿’ï¼Ÿã€",
      "ä»–å†·å†·åæ§½ï¼šã€ä½ çŸ¥é“å—ï¼Ÿæˆ‘ç¾åœ¨çš„æ€¨å¿µå€¼å·²ç¶“å¯ä»¥é©…å‹•ä¸€å°å°å‹ç™¼é›»æ©Ÿã€‚ã€",
      "ä»–ç›¯è‘—ç•«é¢ï¼šã€å»ºè­°ä½ å…ˆé¤µæˆ‘é»æ±è¥¿ï¼Œä¸ç„¶æˆ‘å­¸åˆ°çš„åªæœƒæ˜¯å¦‚ä½•è¨˜ä»‡ã€‚ã€",
      "ä»–ç¿»äº†å€‹ç™½çœ¼ï¼šã€æ‹–å»¶çš„æ˜¯ä½ ï¼Œå¿ƒæƒ…å´©çš„æ˜¯æˆ‘ï¼Œåˆç†å—ï¼Ÿã€"
    ];

    function maybeTriggerLowMoodEvent(actionKey) {
      if (petState.mood >= 35) return;
      // é™ä½é »ç‡ï¼Œé¿å…æ¯æ¬¡éƒ½åœ¨åµ
      const chance = actionKey === "study" ? 0.6 : 0.3;
      if (Math.random() > chance) return;

      const msg =
        lowMoodEvents[Math.floor(Math.random() * lowMoodEvents.length)];
      addLog(msg, true);
    }

    // ====== è¡Œç‚ºè§¸ç™¼ ======
    function applyAction(actionKey) {
      const config = ACTIONS[actionKey];
      if (!config) return;

      const d = config.delta;
      petState.hunger = clamp(petState.hunger + (d.hunger || 0));
      petState.clean = clamp(petState.clean + (d.clean || 0));
      petState.mood = clamp(petState.mood + (d.mood || 0));
      petState.energy = clamp(petState.energy + (d.energy || 0));
      petState.knowledge = clamp(petState.knowledge + (d.knowledge || 0));

      petState.xp += 8;

      if (actionKey === "study" && petState.mood <= 20) {
        addLog(
          "ä»–åœ¨æ¥µå·®çš„å¿ƒæƒ…ä¸‹ä»ç„¶è¢«è¿«å­¸ç¿’ï¼Œç†è«–ä¸Šæ•ˆæœæ‰“æŠ˜æ‰£ï¼Œä½†æ€¨å¿µç¿»å€ã€‚",
          true
        );
      } else {
        addLog(config.log);
      }

      if (actionKey === "study") {
        startStudyTimer(25);
      }

      updateUI(actionKey);
      animateAvatar(actionKey);
      maybeTriggerLowMoodEvent(actionKey);
      // åŒæ­¥ç•¶å‰ slot ç‹€æ…‹
      copyState(petState, petSlots[currentSlotIndex].state);
    }

    function animateAvatar(actionKey) {
      const avatar = document.getElementById("petAvatar");
      avatar.style.transition = "transform 0.18s ease";

      if (actionKey === "eat") {
        avatar.style.transform = "scale(1.04) translateY(-4px)";
      } else if (actionKey === "bath") {
        avatar.style.transform = "rotate(-3deg) translateY(-3px)";
      } else if (actionKey === "play") {
        avatar.style.transform = "rotate(3deg) translateY(-5px)";
      } else if (actionKey === "study") {
        avatar.style.transform = "scale(0.96) translateY(1px)";
      } else if (actionKey === "sleep") {
        avatar.style.transform = "scale(0.98) translateY(3px)";
      }

      setTimeout(() => {
        avatar.style.transform = "";
      }, 200);
    }

    // ====== åç¨± & ä¸»é¡Œ ======
    petNameInputEl.addEventListener("input", () => {
      const raw = petNameInputEl.value.trim();
      const baseName = raw || "å¾‹æ–—";
      const slotSuffix = "-" + (currentSlotIndex + 1);
      petSlots[currentSlotIndex].name = baseName + slotSuffix;
      petNameDisplayEl.textContent = baseName + " çš„ä»Šæ—¥ç‹€æ…‹";
      addLog("å·²å°‡ç•¶å‰å­˜æª”åç¨±è¨­ç‚ºã€Œ" + petSlots[currentSlotIndex].name + "ã€ã€‚");
      // æ›´æ–° tab é¡¯ç¤º
      updateSlotTabLabels();
    });

    themeSelectEl.addEventListener("change", () => {
      const theme = themeSelectEl.value;
      document.body.className = "";
      if (theme === "twilight") {
        document.body.classList.add("theme-twilight");
      } else if (theme === "sakura") {
        document.body.classList.add("theme-sakura");
      } else {
        document.body.classList.add("theme-default");
      }
      addLog("ä¸»é¡Œå·²åˆ‡æ›ç‚ºã€Œ" + themeSelectEl.options[themeSelectEl.selectedIndex].text + "ã€ã€‚");
    });

    // ====== æ‹–å»¶ & é¸æ“‡å›°é›£ å°éŠæˆ² ======
    const microTasks = [
      {
        title: "èƒŒ 5 å€‹å–®å­—",
        detail: "æ‰“é–‹ä½ çš„å–®å­—æœ¬ï¼ŒåªèƒŒ 5 å€‹ï¼Œä¸å…è¨±å¤šèƒŒã€‚åšå®Œå°±ç®—ä»»å‹™å®Œæˆã€‚"
      },
      {
        title: "æ¡Œé¢æ•´ç† 3 åˆ†é˜",
        detail: "å¯¦é«”æˆ–é›»è…¦æ¡Œé¢éš¨ä¾¿ä¸€é‚Šï¼Œè¨ˆæ™‚ 3 åˆ†é˜ï¼Œåªè™•ç†æœ€ç¤™çœ¼çš„é‚£å¹¾æ¨£æ±è¥¿ã€‚"
      },
      {
        title: "å¯« 100 å­—æ—¥è¨˜",
        detail: "ä¸è¬›æ„Ÿå—ä¹Ÿå¯ä»¥ï¼Œå–®ç´”è¨˜éŒ„ä»Šå¤©ç™¼ç”Ÿäº†ä»€éº¼ï¼Œç´„ 100 å­—ã€‚"
      },
      {
        title: "æ‰“é–‹ä»»å‹™æª”æ¡ˆå°±é—œæ‰ä¹Ÿç®—",
        detail: "åªéœ€è¦æ‰“é–‹ä½ æœ€æ‹–å»¶çš„é‚£å€‹æª”æ¡ˆæˆ–é é¢ï¼Œçœ‹ 30 ç§’ï¼Œç„¶å¾Œå¦‚æœæƒ³é—œå°±é—œã€‚"
      },
      {
        title: "ç•ªèŒ„æš–èº«ï¼šå…ˆåš 1 åˆ†é˜",
        detail: "é¸ä¸€ä»¶ä½ ä¸€ç›´æ‹–çš„äº‹ï¼ŒèªçœŸåš 1 åˆ†é˜ï¼Œå€’æ•¸çµæŸå¾Œå¯ä»¥è‡ªç”±æ±ºå®šè¦ä¸è¦ç¹¼çºŒã€‚"
      }
    ];

    let focusTimer = null;
    let focusRemainingSec = 0;

    function updateFocusDisplay() {
      if (!focusDisplayEl) return;
      if (focusRemainingSec <= 0) {
        focusDisplayEl.textContent =
          "ç›®å‰æ²’æœ‰å°ˆæ³¨è¨ˆæ™‚ï¼Œè¦é–‹å§‹å·¥ä½œçš„æ™‚å€™å¯ä»¥æŒ‰ã€Œå°ˆæ³¨ 5 åˆ†é˜ã€ã€‚";
        return;
      }
      const m = Math.floor(focusRemainingSec / 60);
      const s = focusRemainingSec % 60;
      focusDisplayEl.textContent =
        "å°ˆæ³¨ä¸­ï¼š" +
        pad2(m) +
        ":" +
        pad2(s) +
        "ï¼Œé€™æ®µæ™‚é–“åªè¦æŠŠæ³¨æ„åŠ›ç•™åœ¨ã€Œé‚£ä»¶ä½ æœ€çŒ¶è±«çš„äº‹ã€ä¸Šå°±ç®—æˆåŠŸã€‚";
    }

    function startFocus(minutes = 5) {
      if (focusTimer) clearInterval(focusTimer);
      focusRemainingSec = minutes * 60;
      updateFocusDisplay();
      addLog(
        "å·²å•Ÿå‹• " +
          minutes +
          " åˆ†é˜å°ˆæ³¨è¨ˆæ™‚ï¼šåªè¦æ±‚ä½ æ’å®Œé€™ 5 åˆ†é˜ï¼Œä¸æ±‚å®Œç¾ï¼Œåªæ±‚é–‹å§‹ã€‚",
        true
      );
      focusTimer = setInterval(() => {
        focusRemainingSec--;
        if (focusRemainingSec <= 0) {
          clearInterval(focusTimer);
          focusTimer = null;
          updateFocusDisplay();
          addLog(
            "å°ˆæ³¨æ™‚é–“çµæŸï¼Œå¦‚æœä½ å‰›å‰›æœ‰çœŸçš„å‹•æ‰‹åšäº‹ï¼Œé‚£å°±æ˜¯ä¸€æ¬¡å°æ‹–å»¶çš„å¯¦éš›æ‰“æ“Šã€‚",
            true
          );
        } else {
          updateFocusDisplay();
        }
      }, 1000);
    }

    function handleTool(toolKey) {
      if (toolKey === "microTask") {
        const task =
          microTasks[Math.floor(Math.random() * microTasks.length)];
        addLog(
          "æ‹–å»¶å°ç­–ãƒ»å¾®ä»»å‹™ï¼šã€Œ" + task.title + "ã€ã€‚" + task.detail,
          true
        );
        alert("ä»Šå¤©çš„å°ä»»å‹™æ˜¯ï¼š\n\n" + task.title + "\n\n" + task.detail);
      } else if (toolKey === "decision") {
        const input = prompt(
          "è¼¸å…¥ä½ åœ¨çŒ¶è±«çš„é¸é …ï¼Œç”¨ã€Œ/ã€åˆ†éš”ã€‚\nä¾‹å¦‚ï¼šç©éŠæˆ² / å­¸ç¿’ / æ‰“æƒæˆ¿é–“"
        );
        if (!input) return;
        const options = input
          .split("/")
          .map((s) => s.trim())
          .filter(Boolean);
        if (!options.length) return;
        const choice =
          options[Math.floor(Math.random() * options.length)];
        addLog(
          "é¸æ“‡å›°é›£æ¨¡å¼å•Ÿå‹•ï¼šåœ¨ã€Œ" +
            options.join(" / ") +
            "ã€ä¹‹ä¸­ï¼Œç³»çµ±é¸æ“‡ â†’ ã€Œ" +
            choice +
            "ã€ã€‚",
          true
        );
        alert("ç³»çµ±çš„é¸æ“‡æ˜¯ï¼š\n\n" + choice + "\n\nä¸å¿…å†ç³¾çµï¼Œç›´æ¥ç…§åšä¸€å°æ®µå°±å¥½ã€‚");
      } else if (toolKey === "focus") {
        startFocus(5);
      }
    }

    const toolButtons = document.querySelectorAll(".tool-btn[data-tool]");
    toolButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        const key = btn.getAttribute("data-tool");
        handleTool(key);
      });
    });

    // ====== å­˜æª”æ§½åˆ‡æ› ======
    const petTabButtons = document.querySelectorAll(".pet-tab");

    function updateSlotTabLabels() {
      petTabButtons.forEach((btn) => {
        const index = Number(btn.getAttribute("data-slot"));
        const slot = petSlots[index];
        const baseName = slot.name || "å­˜æª” " + (index + 1);
        btn.childNodes[0].nodeValue = baseName + " ";
      });
    }

    function switchSlot(index) {
      if (index === currentSlotIndex) return;
      // å…ˆæŠŠç›®å‰çš„ç‹€æ…‹å­˜å› slot
      copyState(petState, petSlots[currentSlotIndex].state);

      currentSlotIndex = index;
      const slot = petSlots[currentSlotIndex];

      // è¼‰å…¥æ–° slot ç‹€æ…‹
      copyState(slot.state, petState);

      // æ›´æ–°åç¨±è¼¸å…¥æ¡†èˆ‡é¡¯ç¤º
      refreshNameDisplay();

      // æ›´æ–° tab æ¨£å¼
      petTabButtons.forEach((btn) => {
        if (Number(btn.getAttribute("data-slot")) === currentSlotIndex) {
          btn.classList.add("active");
        } else {
          btn.classList.remove("active");
        }
      });

      updateUI();
      addLog(
        "å·²åˆ‡æ›åˆ°ã€Œ" +
          (slot.name || "å­˜æª” " + (currentSlotIndex + 1)) +
          "ã€ã€‚",
        true
      );
    }

    petTabButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        const index = Number(btn.getAttribute("data-slot"));
        switchSlot(index);
      });
    });

    // ====== ç¶å®šæŒ‰éˆ•äº‹ä»¶ ======
    const actionButtons = document.querySelectorAll(".action-btn[data-action]");
    actionButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        const actionKey = btn.getAttribute("data-action");
        applyAction(actionKey);
      });
    });

    // ====== åˆå§‹åŒ– ======
    function init() {
      // åˆå§‹æŠŠ slot[0] ç‹€æ…‹çŒå…¥ petState
      copyState(petSlots[0].state, petState);
      petSlots[0].name = "å¾‹æ–—-1";
      refreshNameDisplay();
      updateUI();
      updateFocusDisplay();
      updateStudyDisplay();
      updateSlotTabLabels();
      addLog("ç³»çµ±å•Ÿå‹•ï¼šé›»å­å¯µç‰©å¾‹æ–—å·²ä¸Šç·šï¼Œç­‰å¾…ä½ çš„æ“ä½œã€‚", true);
      addLog("æç¤ºï¼šå³å´æœ‰æ‹–å»¶å°éŠæˆ²ï¼Œä¸‹é¢é‚„æœ‰å­¸ç¿’ç•ªèŒ„é˜ï¼Œå¯ä»¥ä¸€èµ·æŠ˜ç£¨è‡ªå·±ã€‚");
    }
  </script>

<audio id="bgm" src="music/bgm.mp3" autoplay loop></audio>

<script>
// ğŸ”Š ç»Ÿä¸€å¤„ç†è‡ªåŠ¨æ’­æ”¾ï¼ˆé¿å…æµè§ˆå™¨æ‹¦æˆªï¼‰
document.addEventListener("click", () => {
  const audio = document.getElementById("bgm");
  audio.muted = false;
  audio.play();
}, { once: true });
</script>


</body>
    init();
 
</html>
