<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>å®åŸå¾‹æ–— | è™šæ‹Ÿä¼´ä¾£</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root {
      --primary: #6366f1;
      --secondary: #a855f7;
      --bg-gradient: radial-gradient(circle at top, #f6ebff 0, #e5d8ff 40%, #d9e2ff 100%);
      --glass: rgba(255, 255, 255, 0.85);
      --glass-border: rgba(255, 255, 255, 0.6);
      --text-main: #2d2d3a;
      --text-sub: #666;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; font-family: "Microsoft JhengHei", system-ui, sans-serif; }

    body {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--bg-gradient);
      color: var(--text-main);
      transition: background 0.5s ease;
      background-attachment: fixed;
      background-size: cover;
      background-position: center;
    }

    /* App Container */
    .app {
      width: 95%;
      max-width: 600px;
      background: var(--glass);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border: 1px solid var(--glass-border);
      border-radius: 24px;
      box-shadow: 0 20px 50px rgba(70, 50, 120, 0.15);
      padding: 25px;
      display: flex;
      flex-direction: column;
      gap: 20px;
      animation: popIn 0.6s cubic-bezier(0.2, 0.8, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    @keyframes popIn {
      from { opacity: 0; transform: scale(0.95) translateY(20px); }
      to { opacity: 1; transform: scale(1) translateY(0); }
    }

    /* Header & Slots */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-bottom: 15px;
      border-bottom: 2px dashed rgba(99, 102, 241, 0.2);
    }
    .title { font-size: 1.4rem; font-weight: 800; color: #4b0082; letter-spacing: 1px; }
    
    .slot-container { display: flex; gap: 8px; background: rgba(255,255,255,0.5); padding: 4px; border-radius: 12px; }
    .pet-tab {
      border: none; background: transparent; padding: 6px 12px;
      border-radius: 8px; cursor: pointer; font-size: 0.85rem; color: #666;
      transition: all 0.2s;
    }
    .pet-tab.active { background: white; color: var(--primary); box-shadow: 0 2px 8px rgba(0,0,0,0.05); font-weight: bold; }

    /* Pet Display Area */
    .pet-display {
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      padding: 20px 0;
      position: relative;
    }
    
    .avatar-wrapper {
      width: 140px; height: 140px;
      display: flex; align-items: center; justify-content: center;
      position: relative;
      cursor: pointer;
    }
    
    /* å‘¼å¸åŠ¨ç”» */
    .avatar-animate { animation: float 3s ease-in-out infinite; }
    @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-8px); } }

    .kaomoji {
      font-size: 3.5rem; font-weight: bold; color: #4b0082;
      text-shadow: 0 4px 10px rgba(99, 102, 241, 0.2);
    }
    
    .speech-bubble {
      background: white; padding: 8px 16px; border-radius: 20px 20px 20px 0;
      box-shadow: 0 4px 15px rgba(0,0,0,0.05);
      font-size: 0.9rem; color: #555; margin-bottom: 15px;
      opacity: 0; transform: translateY(10px);
      transition: all 0.3s;
    }
    .speech-bubble.show { opacity: 1; transform: translateY(0); }

    /* Stats Bars */
    .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; width: 100%; }
    .stat-item { background: rgba(255,255,255,0.5); padding: 10px; border-radius: 12px; }
    .stat-label { font-size: 0.8rem; margin-bottom: 6px; color: #666; display: flex; justify-content: space-between; }
    
    .progress-bg { height: 8px; background: #eee; border-radius: 4px; overflow: hidden; }
    .progress-fill { height: 100%; width: 50%; border-radius: 4px; transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1); }
    
    /* Colors for stats */
    .fill-hp { background: linear-gradient(90deg, #ff9a9e, #fecfef); box-shadow: 0 0 10px rgba(255, 154, 158, 0.4); }
    .fill-mood { background: linear-gradient(90deg, #a18cd1, #fbc2eb); box-shadow: 0 0 10px rgba(161, 140, 209, 0.4); }
    .fill-food { background: linear-gradient(90deg, #84fab0, #8fd3f4); box-shadow: 0 0 10px rgba(132, 250, 176, 0.4); }
    .fill-energy { background: linear-gradient(90deg, #fccb90, #d57eeb); box-shadow: 0 0 10px rgba(252, 203, 144, 0.4); }

    /* Actions */
    .actions { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top: 10px; }
    .action-btn {
      border: none; background: white; padding: 12px 0; border-radius: 12px;
      font-size: 1.2rem; cursor: pointer; transition: all 0.2s;
      box-shadow: 0 4px 6px rgba(0,0,0,0.05); color: var(--primary);
    }
    .action-btn:hover { transform: translateY(-3px); box-shadow: 0 8px 15px rgba(99, 102, 241, 0.2); background: #fbfaff; }
    .action-btn:active { transform: scale(0.95); }
    .btn-label { display: block; font-size: 0.75rem; margin-top: 4px; color: #888; }

    /* Log */
    .log-area {
      height: 100px; background: rgba(0,0,0,0.03); border-radius: 12px;
      padding: 10px; overflow-y: auto; font-size: 0.85rem; color: #666;
      border: 1px solid rgba(0,0,0,0.05);
    }
    .log-entry { margin-bottom: 6px; padding-left: 10px; border-left: 3px solid var(--primary); animation: slideIn 0.3s ease; }
    @keyframes slideIn { from { opacity: 0; transform: translateX(-10px); } to { opacity: 1; transform: translateX(0); } }

    /* Custom Settings */
    .settings-area { margin-top: 10px; text-align: center; }
    .custom-btn-small {
      background: transparent; border: 1px solid #ccc; padding: 5px 10px;
      border-radius: 20px; font-size: 0.8rem; color: #666; cursor: pointer;
    }
    .custom-btn-small:hover { background: white; color: var(--primary); border-color: var(--primary); }

    /* Boot Screen */
    #bootScreen {
      position: fixed; inset: 0; background: #0c1024; z-index: 9999;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      color: #e5e5ff; font-size: 1rem;
    }
  </style>
</head>
<body>

  <audio id="bgm" src="" loop></audio>

  <div id="bootScreen">
    <div style="margin-bottom: 15px; font-size: 1.2rem; letter-spacing: 2px;">RITSUTO SYSTEM</div>
    <div style="width: 220px; height: 6px; background: rgba(255,255,255,0.1); border-radius: 4px; overflow: hidden;">
      <span style="display: block; height: 100%; width: 0%; background: linear-gradient(90deg, #6366f1, #a855f7); animation: loadingProgress 2s linear forwards;"></span>
    </div>
    <div style="margin-top: 10px; font-size: 0.8rem; opacity: 0.6;">Initializing Personality Modules...</div>
  </div>

  <div class="app">
    <div class="header">
      <div class="title">å®åŸå¾‹æ–—</div>
      <div class="slot-container">
        <button class="pet-tab active" data-slot="0">æ§½ä½1</button>
        <button class="pet-tab" data-slot="1">æ§½ä½2</button>
        <button class="pet-tab" data-slot="2">æ§½ä½3</button>
      </div>
    </div>

    <div class="pet-display">
      <div class="speech-bubble" id="speechBubble">ä»Šå¤©æ„Ÿè§‰ä¸é”™å“¦~ (â—•â€¿â—•)</div>
      <div class="avatar-wrapper avatar-animate" id="petAvatar" title="ç‚¹å‡»æ›´æ¢è‡ªå®šä¹‰å¤´åƒ">
        <div id="petFace" class="kaomoji">(â—•â€¿â—•âœ¿)</div>
      </div>
    </div>

    <div class="stats-grid">
      <div class="stat-item">
        <div class="stat-label"><span>å¿ƒæƒ… (Mood)</span><span id="val-mood">100%</span></div>
        <div class="progress-bg"><div class="progress-fill fill-mood" id="bar-mood" style="width: 100%"></div></div>
      </div>
      <div class="stat-item">
        <div class="stat-label"><span>é¥±é£Ÿ (Hunger)</span><span id="val-hunger">0%</span></div>
        <div class="progress-bg"><div class="progress-fill fill-food" id="bar-hunger" style="width: 0%"></div></div>
      </div>
      <div class="stat-item">
        <div class="stat-label"><span>ç²¾åŠ› (Energy)</span><span id="val-energy">100%</span></div>
        <div class="progress-bg"><div class="progress-fill fill-energy" id="bar-energy" style="width: 100%"></div></div>
      </div>
      <div class="stat-item">
        <div class="stat-label"><span>å¥åº· (Health)</span><span id="val-health">100%</span></div>
        <div class="progress-bg"><div class="progress-fill fill-hp" id="bar-health" style="width: 100%"></div></div>
      </div>
    </div>

    <div class="actions">
      <button class="action-btn" data-action="feed">
        ğŸ±
        <span class="btn-label">æŠ•å–‚</span>
      </button>
      <button class="action-btn" data-action="play">
        ğŸ®
        <span class="btn-label">ç©è€</span>
      </button>
      <button class="action-btn" data-action="sleep">
        ğŸ’¤
        <span class="btn-label">ä¼‘æ¯</span>
      </button>
      <button class="action-btn" data-action="clean">
        âœ¨
        <span class="btn-label">æ¸…ç†</span>
      </button>
    </div>

    <div class="log-area" id="gameLog">
      </div>

    <div class="settings-area">
      <label class="custom-btn-small">
        ğŸ–¼ï¸ æ›´æ¢èƒŒæ™¯
        <input type="file" id="customBgInput" accept="image/*" style="display: none;">
      </label>
      <span style="font-size:0.8rem; color:#999; margin-left:10px;">æç¤ºï¼šç‚¹å‡»ä¸­é—´çš„é¢œæ–‡å­—å¯ä¸Šä¼ å›¾ç‰‡å¤´åƒ</span>
    </div>
  </div>

<script>
/**
 * ğŸ› ï¸ æ ¸å¿ƒå¼•æ“é€»è¾‘
 * åŒ…å«çŠ¶æ€ç®¡ç†ã€å­˜æ¡£ç³»ç»Ÿã€é¢œæ–‡å­—é€»è¾‘
 */

// === 1. åˆå§‹åŒ–æ•°æ® ===
const defaultState = {
  name: "å¾‹æ–—",
  mood: 80,    // 0-100 (è¶Šé«˜è¶Šå¥½)
  hunger: 20,  // 0-100 (è¶Šä½è¶Šå¥½)
  energy: 90,  // 0-100 (è¶Šé«˜è¶Šå¥½)
  health: 100, // 0-100 (è¶Šé«˜è¶Šå¥½)
  exp: 0
};

// 3ä¸ªå­˜æ¡£æ§½ä½
let petSlots = [
  { name: "å¾‹æ–—-1", state: { ...defaultState } },
  { name: "å¾‹æ–—-2", state: { ...defaultState } },
  { name: "å¾‹æ–—-3", state: { ...defaultState } }
];

// å½“å‰è¿è¡ŒçŠ¶æ€ (æ·±æ‹·è´)
let currentSlotIndex = 0;
let petState = { ...defaultState };

// é¢œæ–‡å­—å­—å…¸ (Moe System)
const emotions = {
  happy: ["(â—•â€¿â—•âœ¿)", "(â‰§â—¡â‰¦)", "(*^â–½^*)", "(UwU)"],
  normal: ["(ãƒ»_ãƒ»)", "(OwO)", "(â€¢Ì€á´—â€¢Ì)Ùˆ", "(Â¬_Â¬)"],
  sad: ["(ï½¡â€¢Ìï¸¿â€¢Ì€ï½¡)", "(T_T)", "(;Â´à¼àº¶Ğ”à¼àº¶`)", "(._.)"],
  dead: ["(Ã—_Ã—)", "(âœ–â•­â•®âœ–)"],
  sleeping: ["(Â¦ê’‰[â–“â–“]", "(u_u)...zzZ"],
  eating: ["(à¹‘Â´Ú¡`à¹‘)", "( oË˜â—¡Ë˜o)"]
};

// === 2. æ ¸å¿ƒåŠŸèƒ½å‡½æ•° ===

// æ·±åº¦æ‹·è´è¾…åŠ©å‡½æ•°
function copyState(target, source) {
  Object.assign(target, source);
}

// æ·»åŠ æ—¥å¿—
function addLog(msg, isSystem = false) {
  const logEl = document.getElementById("gameLog");
  const entry = document.createElement("div");
  entry.className = "log-entry";
  const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
  entry.innerHTML = `<span style="color:#aaa;font-size:0.8em">[${time}]</span> ${msg}`;
  if (isSystem) entry.style.borderLeftColor = "#ff5252";
  
  logEl.appendChild(entry);
  logEl.scrollTop = logEl.scrollHeight;
}

// æ›´æ–°é¢œæ–‡å­—å’Œæ°”æ³¡
function updateExpression(override = null) {
  const faceEl = document.getElementById("petFace");
  const bubble = document.getElementById("speechBubble");
  
  // å¦‚æœç”¨æˆ·ä¸Šä¼ äº†å›¾ç‰‡å¤´åƒï¼Œå°±ä¸æ›´æ–°é¢œæ–‡å­—
  if (faceEl.innerHTML.includes("<img")) return; 

  if (override) {
    faceEl.innerText = override;
    return;
  }

  let status = "normal";
  let say = "......";

  if (petState.health <= 0) { status = "dead"; say = "ç³»ç»Ÿç¦»çº¿..."; }
  else if (petState.energy < 20) { status = "sleeping"; say = "å¥½å›°å•Š..."; }
  else if (petState.mood > 80) { status = "happy"; say = "æ„Ÿè§‰æ£’æäº†ï¼"; }
  else if (petState.mood < 30 || petState.hunger > 80) { status = "sad"; say = "æˆ‘ä¸èˆ’æœ..."; }
  
  // éšæœºå–ä¸€ä¸ªé¢œæ–‡å­—
  const list = emotions[status];
  faceEl.innerText = list[Math.floor(Math.random() * list.length)];
  
  // å¶å°”æ˜¾ç¤ºæ°”æ³¡
  if(Math.random() > 0.7) {
    bubble.innerText = say;
    bubble.classList.add("show");
    setTimeout(() => bubble.classList.remove("show"), 3000);
  }
}

// æ›´æ–°ç•Œé¢è¿›åº¦æ¡
function updateUI() {
  // é™åˆ¶æ•°å€¼èŒƒå›´ 0-100
  ["mood", "hunger", "energy", "health"].forEach(key => {
    if (petState[key] > 100) petState[key] = 100;
    if (petState[key] < 0) petState[key] = 0;
    
    document.getElementById(`val-${key}`).innerText = Math.floor(petState[key]) + "%";
    document.getElementById(`bar-${key}`).style.width = petState[key] + "%";
  });

  updateExpression();
}

// è¡Œä¸ºå¤„ç†
function applyAction(action) {
  if (petState.health <= 0) {
    addLog("å¾‹æ–—å·²ç»æ— æ³•å›åº”ä½ äº†...", true);
    return;
  }

  const bubble = document.getElementById("speechBubble");
  bubble.classList.add("show");

  switch (action) {
    case "feed":
      petState.hunger -= 20;
      petState.health += 2;
      petState.energy += 5;
      addLog("å–‚é£Ÿï¼šä¸ä»…åƒé¥±äº†ï¼Œè¿˜æ„Ÿåˆ°å¾ˆæ»¡è¶³ã€‚");
      bubble.innerText = "å¥½åƒæ(à¹‘Â´Ú¡`à¹‘)";
      updateExpression("(à¹‘Â´Ú¡`à¹‘)");
      break;
    case "play":
      if (petState.energy < 10) {
        addLog("å¤ªç´¯äº†ï¼Œç©ä¸åŠ¨äº†ã€‚", true);
        return;
      }
      petState.mood += 15;
      petState.energy -= 15;
      petState.hunger += 5;
      addLog("ç©è€ï¼šå¿ƒæƒ…å˜å¥½äº†ï¼Œä½†æ˜¯æœ‰ç‚¹ç´¯ã€‚");
      bubble.innerText = "å¥½è€¶ï¼(â‰§â—¡â‰¦)";
      break;
    case "sleep":
      petState.energy += 40;
      petState.hunger += 10;
      petState.health += 5;
      addLog("ä¼‘æ¯ï¼šç²¾åŠ›å……æ²›ï¼");
      bubble.innerText = "å‘¼...zzZ";
      updateExpression("(Â¦ê’‰[â–“â–“]");
      break;
    case "clean":
      petState.health += 5;
      petState.mood += 5;
      addLog("æ¸…ç†ï¼šç¯å¢ƒå˜å¾—æ•´æ´äº†ã€‚");
      bubble.innerText = "æ¸…çˆ½ï¼âœ¨";
      break;
  }
  
  setTimeout(() => bubble.classList.remove("show"), 2000);
  updateUI();
}

// è‡ªç„¶è¡°å‡å¾ªç¯ (æ¨¡æ‹Ÿæ—¶é—´æµé€)
setInterval(() => {
  if (petState.health <= 0) return;

  petState.hunger += 0.5; // å˜é¥¿
  petState.mood -= 0.5;   // å¿ƒæƒ…å˜å·®
  petState.energy -= 0.2; // ç²¾åŠ›æ¶ˆè€—

  // çŠ¶æ€æƒ©ç½š
  if (petState.hunger > 90) petState.health -= 1;
  if (petState.mood < 10) petState.health -= 0.5;

  updateUI();
}, 2000); // æ¯2ç§’æ‰§è¡Œä¸€æ¬¡

// === 3. äº‹ä»¶ç»‘å®š ===

// åˆ‡æ¢å­˜æ¡£æ§½é€»è¾‘
const petTabButtons = document.querySelectorAll(".pet-tab");
function switchSlot(index) {
  if (index === currentSlotIndex) return;
  
  // ä¿å­˜å½“å‰
  copyState(petSlots[currentSlotIndex].state, petState);
  
  // åˆ‡æ¢
  currentSlotIndex = index;
  copyState(petState, petSlots[index].state);
  
  // UIæ›´æ–°
  petTabButtons.forEach(btn => btn.classList.remove("active"));
  petTabButtons[index].classList.add("active");
  
  addLog(`å·²åˆ‡æ¢åˆ°å­˜å‚¨æ§½ ${index + 1}`, true);
  updateUI();
}

petTabButtons.forEach(btn => {
  btn.addEventListener("click", () => switchSlot(Number(btn.getAttribute("data-slot"))));
});

// æŒ‰é’®ç‚¹å‡»
document.querySelectorAll(".action-btn").forEach(btn => {
  btn.addEventListener("click", () => applyAction(btn.getAttribute("data-action")));
});

// === 4. è‡ªå®šä¹‰å›¾ç‰‡åŠŸèƒ½ (ä¿ç•™å¹¶ä¼˜åŒ–) ===

// èƒŒæ™¯å›¾
document.getElementById("customBgInput").addEventListener("change", function() {
  const file = this.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = function(e) {
    document.body.style.background = `url('${e.target.result}') center/cover fixed`;
    localStorage.setItem("ritsuto_bg", e.target.result);
    addLog("èƒŒæ™¯å·²æ›´æ–° âœ¨", true);
  };
  reader.readAsDataURL(file);
});

// å¤´åƒä¸Šä¼  (ç‚¹å‡»é¢œæ–‡å­—åŒºåŸŸ)
const avatarInput = document.createElement("input");
avatarInput.type = "file";
avatarInput.accept = "image/*";
avatarInput.style.display = "none";
document.body.appendChild(avatarInput);

document.getElementById("petAvatar").addEventListener("click", () => avatarInput.click());

avatarInput.addEventListener("change", function() {
  const file = this.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = function(e) {
    const faceEl = document.getElementById("petFace");
    faceEl.innerHTML = `<img src="${e.target.result}" style="width:100%;height:100%;object-fit:contain;border-radius:50%;">`;
    localStorage.setItem("ritsuto_avatar", e.target.result);
    addLog("å¤´åƒå·²æ›´æ¢ (é¢œæ–‡å­—æ¨¡å¼å·²æš‚åœ)", true);
  };
  reader.readAsDataURL(file);
});

// === 5. å¯åŠ¨ä¸åŠ è½½ ===
window.addEventListener("load", () => {
  // æ¨¡æ‹ŸåŠ è½½æ¡
  setTimeout(() => {
    const bs = document.getElementById("bootScreen");
    bs.style.opacity = "0";
    bs.style.transition = "opacity 0.8s";
    setTimeout(() => bs.remove(), 800);
    
    addLog("ç³»ç»Ÿå¯åŠ¨å®Œæˆã€‚å¾‹æ–—å·²ä¸Šçº¿ã€‚", true);
    updateUI();
  }, 2000);

  // è¯»å–æœ¬åœ°å­˜å‚¨çš„å›¾ç‰‡
  const savedBg = localStorage.getItem("ritsuto_bg");
  if(savedBg) document.body.style.background = `url('${savedBg}') center/cover fixed`;
  
  const savedAvatar = localStorage.getItem("ritsuto_avatar");
  if(savedAvatar) {
     document.getElementById("petFace").innerHTML = `<img src="${savedAvatar}" style="width:100%;height:100%;object-fit:contain;border-radius:50%;">`;
  }
  
  // éŸ³ä¹äº¤äº’ (ç‚¹å‡»é¡µé¢ä»»æ„ä½ç½®æ’­æ”¾ï¼Œè§„é¿æµè§ˆå™¨ç­–ç•¥)
  document.addEventListener("click", () => {
    const audio = document.getElementById("bgm");
    // æ³¨æ„ï¼šä½ éœ€è¦è‡ªå·±æ”¾å…¥éŸ³ä¹æ–‡ä»¶æˆ–é“¾æ¥ï¼Œè¿™é‡Œä½¿ç”¨äº†ç©ºé“¾æ¥é¿å…æŠ¥é”™
    if(audio.src) audio.play().catch(e=>{}); 
  }, { once: true });
});

</script>
</body>
  </html>
